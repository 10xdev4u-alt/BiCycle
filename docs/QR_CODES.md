# SVCE Cycle Access System - QR Code Specifications

This document outlines the data structure for all QR codes used in the system. All QR codes containing sensitive data are encrypted using **AES-256-CBC** with a secret key stored on the server.

---

## 1. Static QR Codes

Static QR codes are physically placed on bikes and stands. They contain encrypted JSON payloads.

### 1.1. Stand QR Code

Placed at each designated bike stand location (e.g., Boys Hostel, Girls Hostel, Main Gate).

**Payload (Encrypted JSON):**
```json
{
  "type": "stand",
  "id": "stand_bh_01",
  "location": "boys_hostel",
  "timestamp": 1699123456000
}
```

- **`type`**: Always `"stand"`.
- **`id`**: A unique identifier for the stand (e.g., `stand_bh_01`).
- **`location`**: A human-readable description of the stand's location.
- **`timestamp`**: A UNIX timestamp of when the QR code was generated, for versioning.

### 1.2. Bike QR Code

Placed on each individual bicycle.

**Payload (Encrypted JSON):**
```json
{
  "type": "bike",
  "id": "bike_svce_07",
  "initial_stand": "BH01",
  "timestamp": 1699123456000
}
```

- **`type`**: Always `"bike"`.
- **`id`**: A unique identifier for the bicycle (e.g., `bike_svce_07`).
- **`initial_stand`**: The ID of the stand where the bike was first registered.
- **`timestamp`**: A UNIX timestamp of when the QR code was generated.

---

## 2. Dynamic QR Codes (Tickets)

Dynamic QR codes are generated by the student's app for verification by the guard. They are **JSON Web Tokens (JWTs)** with a short expiry time (5-10 minutes).

### 2.1. Pickup Ticket

Generated after a student successfully books a bike and uploads a pickup photo.

**Payload (JWT):**
```json
{
  "booking_id": "bk_7f3a9c2e",
  "type": "pickup",
  "bike_uuid": "bike_svce_07",
  "reg_no": "2023CS0113",
  "guard_code": "3847",
  "exp": 1699123756
}
```

- **`booking_id`**: The unique ID for this booking transaction.
- **`type`**: Always `"pickup"`.
- **`bike_uuid`**: The unique ID of the booked bike.
- **`reg_no`**: The student's registration number.
- **`guard_code`**: A short, human-readable code for manual verification if the QR scan fails.
- **`exp`**: The standard JWT `exp` claim (expiration time). Set to 5 minutes from generation.

### 2.2. Return Ticket

Generated after a student scans a return stand and uploads a return photo.

**Payload (JWT):**
```json
{
  "booking_id": "bk_7f3a9c2e",
  "type": "return",
  "bike_uuid": "bike_svce_07",
  "reg_no": "2023CS0113",
  "duration_min": 45,
  "exp": 1699124356
}
```

- **`booking_id`**: The unique ID for this booking transaction.
- **`type`**: Always `"return"`.
- **`bike_uuid`**: The unique ID of the returned bike.
- **`reg_no`**: The student's registration number.
- **`duration_min`**: The total duration of the ride in minutes.
- **`exp`**: The standard JWT `exp` claim (expiration time). Set to 10 minutes from generation.

---
